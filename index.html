<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoreo Divinext</title>
 <link rel="icon" type="image/png" href="img/Logo1.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="img/Logo1.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="msapplication-TileColor" content="#0a0a0a" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --accent: #22c55e;
            /* Verde principal */
            --accent-soft: #4ade80;
            /* Verde claro */
            --accent-alt: #0ea5e9;
            /* Azul apoyo */
            --bg-main: #050816;
            --bg-card: #0b1220;
            --bg-card-soft: #111827;
            --border-soft: #1f2937;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
        }

        body {
            background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
            color: var(--text-main);
            font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            padding-top: 80px;
        }

        /* NAVBAR */
        .navbar-custom {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid rgba(148, 163, 184, 0.35);
            backdrop-filter: blur(14px);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--accent-soft) !important;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            font-size: 0.95rem;
        }

        .navbar-subtitle {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
        }

        /* SECCIONES / TITULOS */
        .section-title {
            font-size: 1.25rem;
            margin: 18px 0 12px;
            padding-left: 10px;
            border-left: 4px solid var(--accent);
            font-weight: 600;
        }

        .section-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: -6px;
            margin-bottom: 12px;
        }

        /* TABS */
        .dashboard-tabs {
            border-bottom: 1px solid rgba(148, 163, 184, 0.3);
        }

        .dashboard-tabs .nav-link {
            color: var(--text-muted);
            border: none;
            border-bottom: 2px solid transparent;
            border-radius: 0;
            padding: 10px 14px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .dashboard-tabs .nav-link.active {
            color: var(--accent-soft);
            border-color: var(--accent-soft);
            background-color: transparent;
        }

        .dashboard-tabs .nav-link:hover {
            color: var(--accent-soft);
        }

        /* TARJETAS */
        .card-custom {
            background:
                radial-gradient(circle at top left, rgba(34, 197, 94, 0.08), transparent 45%),
                var(--bg-card);
            border-radius: 16px;
            padding: 18px 18px 16px;
            border: 1px solid rgba(148, 163, 184, 0.25);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
            position: relative;
            overflow: hidden;
        }

        .card-custom::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            border: 1px solid transparent;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.5), rgba(56, 189, 248, 0.4));
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            mix-blend-mode: soft-light;
        }

        .card-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 24px 60px rgba(0, 0, 0, 0.75);
            border-color: rgba(74, 222, 128, 0.7);
        }

        .card-custom:hover::before {
            opacity: 0.22;
        }

        .card-title-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h5 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 4px;
        }

        .card-chip {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            padding: 3px 9px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            color: var(--text-muted);
        }

        /* ALTURA CHARTS */
        .chart-container {
            height: 260px;
            position: relative;
        }

        .chart-container canvas {
            max-height: 100%;
        }

        /* RESUMEN */
        .summary-box {
            margin-top: 10px;
            padding: 10px 12px;
            background: var(--bg-card-soft);
            border-radius: 10px;
            border: 1px solid rgba(55, 65, 81, 0.9);
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: baseline;
        }

        .summary-main {
            flex: 1;
        }

        .summary-title {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .summary-number {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--accent-soft);
        }

        .summary-detail {
            font-size: 0.78rem;
            color: var(--text-muted);
            line-height: 1.3;
        }

        .summary-badge {
            font-size: 0.72rem;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(34, 197, 94, 0.18);
            color: var(--accent-soft);
            border: 1px solid rgba(34, 197, 94, 0.4);
            white-space: nowrap;
        }

        /* LISTADO DISTRITOS */
        .district-list {
            max-height: 260px;
            overflow-y: auto;
            margin-top: 6px;
        }

        .district-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.82rem;
            padding: 4px 0;
            border-bottom: 1px dashed rgba(55, 65, 81, 0.7);
        }

        .district-item:last-child {
            border-bottom: none;
        }

        .district-name {
            color: #e5e7eb;
        }

        .district-count {
            color: var(--accent-soft);
            font-weight: 600;
        }

        /* SCROLLBAR */
        .district-list::-webkit-scrollbar {
            width: 6px;
        }

        .district-list::-webkit-scrollbar-track {
            background: #020617;
        }

        .district-list::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 999px;
        }

        @media (max-width: 991.98px) {
            .chart-container {
                height: 220px;
            }
        }
    </style>
</head>

<body>

    <!-- NAV -->
    <nav class="navbar navbar-dark navbar-custom fixed-top px-3 py-2">
        <div class="container-fluid">
            <div>
                <span class="navbar-brand">Monitoreo táctico · DIVINEXT</span><br>
                <span class="navbar-subtitle">Dashboard de extorsiones</span>
            </div>
            <span class="badge rounded-pill text-bg-dark border border-success">
                <span
                    style="width:8px;height:8px;border-radius:999px;background:#22c55e;display:inline-block;margin-right:6px;"></span>
                Online
            </span>
        </div>
    </nav>

    <div class="container-fluid" id="mainContainer">

        <!-- Aquí pondremos un mensaje si es modo file:// -->
        <div id="envWarningContainer" class="mt-2"></div>

        <!-- TABS PRINCIPALES -->
        <ul class="nav nav-tabs dashboard-tabs mt-2" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="resumen-tab" data-bs-toggle="tab" data-bs-target="#resumen"
                    type="button" role="tab">
                    Resumen Operativo
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="distritos-tab" data-bs-toggle="tab" data-bs-target="#distritos"
                    type="button" role="tab">
                    Distritos y Denuncias
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="incautadas-tab" data-bs-toggle="tab" data-bs-target="#incautadas"
                    type="button" role="tab">
                    Especies incautadas por extorsión
                </button>
            </li>
        </ul>

        <div class="tab-content mt-3">

            <!-- TAB 1: RESUMEN -->
            <div class="tab-pane fade show active" id="resumen" role="tabpanel" aria-labelledby="resumen-tab">

                <div class="section-title">Estadísticas de Detenidos</div>
                <div class="section-subtitle">
                    Vista rápida del perfil de detenidos para orientar las decisiones operativas.
                </div>

                <div class="row g-4">

                    <!-- GÉNERO -->
                    <div class="col-lg-4">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Por Género</h5>
                                <span class="card-chip">Perfil de Detenidos</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="generoChart"></canvas>
                            </div>

                            <div id="generoResumen" class="summary-box"></div>
                        </div>
                    </div>

                    <!-- NACIONALIDAD -->
                    <div class="col-lg-4">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Por Nacionalidad</h5>
                                <span class="card-chip">Caracterización</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="nacionalidadChart"></canvas>
                            </div>
                            <div id="nacionalidadResumen" class="summary-box"></div>
                        </div>
                    </div>

                    <!-- SITUACIÓN -->
                    <div class="col-lg-4">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Situación Legal</h5>
                                <span class="card-chip">Estado Procesal</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="situacionChart"></canvas>
                            </div>
                            <div id="situacionResumen" class="summary-box"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: DISTRITOS -->
            <div class="tab-pane fade" id="distritos" role="tabpanel" aria-labelledby="distritos-tab">

                <div class="section-title">Mapa de Distritos</div>
                <div class="section-subtitle">
                    Distribución de denuncias por distrito para priorización de zonas críticas.
                </div>

                <div class="row g-4">
                    <!-- DENUNCIAS -->
                    <div class="col-lg-8">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Denuncias por Distrito</h5>
                                <span class="card-chip">Zonas de Mayor Incidencia</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="denunciasChart"></canvas>
                            </div>
                            <div id="denunciasResumen" class="summary-box"></div>
                        </div>
                    </div>

                    <!-- LISTADO ORDENADO -->
                    <div class="col-lg-4">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Ranking de Distritos</h5>
                                <span class="card-chip">Detalle Complementario</span>
                            </div>
                            <div class="district-list" id="districtList">
                                <!-- Se llena con JS usando los mismos datos -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: ESPECIES INCAUTADAS -->
            <div class="tab-pane fade" id="incautadas" role="tabpanel" aria-labelledby="incautadas-tab">

                <div class="section-title mt-2">Especies incautadas en casos de extorsión</div>
                <div class="section-subtitle">
                    Concentrado de vehículos, armas, drogas, dinero y otros elementos incautados durante las
                    intervenciones vinculadas al delito de extorsión.
                </div>

                <div class="row g-4">
                    <!-- ESPECIES (SIN DINERO) -->
                    <div class="col-lg-8">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Especies incautadas (sin considerar dinero)</h5>
                                <span class="card-chip">Vehículos, armas, drogas y otros</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="especiesChart"></canvas>
                            </div>
                            <div id="especiesResumen" class="summary-box"></div>
                        </div>
                    </div>

                    <!-- DINERO -->
                    <div class="col-lg-4">
                        <div class="card-custom">
                            <div class="card-title-main">
                                <h5>Dinero incautado</h5>
                                <span class="card-chip">Impacto económico</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="dineroChart"></canvas>
                            </div>
                            <div id="dineroResumen" class="summary-box"></div>
                        </div>
                    </div>
                </div>

            </div>

        </div> <!-- /tab-content -->

    </div> <!-- /container-fluid -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        ////////////// COLORES BASE DESDE :root //////////////////
        const rootStyles = getComputedStyle(document.documentElement);
        const colorAccent = rootStyles.getPropertyValue('--accent').trim();         // verde principal
        const colorAccentSoft = rootStyles.getPropertyValue('--accent-soft').trim(); // verde claro
        const colorAccentAlt = rootStyles.getPropertyValue('--accent-alt').trim();   // azul apoyo;

        const colorWarning = '#facc15'; // amarillo
        const colorDanger = '#fb7185';  // rojo suave
        const colorInfo = '#38bdf8';    // celeste
        const colorPurple = '#a855f7';  // morado
        const colorSlate = '#64748b';   // gris azulado

        const baseChartOptions = {
            animation: {
                duration: 800,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#e5e7eb',
                        font: { size: 11 }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(15,23,42,0.95)',
                    borderColor: 'rgba(148,163,184,0.5)',
                    borderWidth: 1,
                    titleColor: '#e5e7eb',
                    bodyColor: '#e5e7eb',
                    padding: 8,
                    displayColors: true
                }
            }
        };

        // Detectar si estamos en file://
        const isLocalFile = window.location.protocol === 'file:';

        function showEnvWarning() {
            const container = document.getElementById('envWarningContainer');
            container.innerHTML = `
                <div class="alert alert-warning alert-dismissible fade show small mb-2" role="alert">
                    <strong>Modo local (file://):</strong> 
                    Por seguridad del navegador no se pueden cargar los archivos JSON con <code>fetch</code>.
                    Para ver los gráficos, ábrelo con <strong>"Open with Live Server"</strong> en VS Code
                    o desde un servidor web.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                </div>
            `;
        }

        function putLocalSummaryPlaceholders() {
            const placeholders = [
                "generoResumen",
                "nacionalidadResumen",
                "situacionResumen",
                "denunciasResumen",
                "especiesResumen",
                "dineroResumen"
            ];

            placeholders.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.innerHTML = `
                        <div class="summary-main">
                            <div class="summary-title">Datos no disponibles en modo local</div>
                            <div class="summary-number">—</div>
                            <div class="summary-detail">
                                Para visualizar estos indicadores, ejecute el dashboard mediante 
                                <strong>Live Server</strong> u otro servidor web.
                            </div>
                        </div>
                        <div class="summary-badge">
                            Vista sin datos
                        </div>
                    `;
                }
            });
        }

        // Helper para fetch con manejo de errores
        function fetchJson(url) {
            return fetch(url).then(r => {
                if (!r.ok) {
                    throw new Error(`Error HTTP ${r.status} al cargar ${url}`);
                }
                return r.json();
            }).catch(err => {
                console.error('Error cargando JSON:', url, err);
                throw err;
            });
        }

        ///////////////////////////
        //      DETENIDOS
        ///////////////////////////
        function initDetenidos() {
            fetchJson('./data/detenidos.json')
                .then(data => {
                    // GÉNERO
                    const generoObj = data.genero[0];
                    const g_h = generoObj["HOMBRES"] ?? 0;
                    const g_m = generoObj["MUJERES"] ?? 0;

                    const generoCtx = document.getElementById('generoChart');
                    new Chart(generoCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Hombres', 'Mujeres'],
                            datasets: [{
                                data: [g_h, g_m],
                                backgroundColor: [colorAccent, colorDanger],
                                hoverBackgroundColor: [colorAccentSoft, '#f97373'],
                                borderColor: '#020617',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            ...baseChartOptions,
                            plugins: {
                                ...baseChartOptions.plugins,
                                legend: {
                                    ...baseChartOptions.plugins.legend,
                                    position: 'bottom'
                                }
                            }
                        }
                    });

                    document.getElementById("generoResumen").innerHTML =
                        `<div class="summary-main">
                            <div class="summary-title">Total Detenidos</div>
                            <div class="summary-number">${g_h + g_m}</div>
                            <div class="summary-detail">
                                Hombres: <strong>${g_h}</strong> &nbsp;·&nbsp;
                                Mujeres: <strong>${g_m}</strong>
                            </div>
                        </div>
                        <div class="summary-badge">
                            Perfil demográfico
                        </div>`;

                    // NACIONALIDAD
                    const nacObj = data.nacionalidad[0];
                    const n_v = nacObj["VENEZUELA"] ?? 0;
                    const n_p = nacObj["PERÚ"] ?? nacObj["PERU"] ?? 0;

                    const nacionalidadCtx = document.getElementById('nacionalidadChart');
                    new Chart(nacionalidadCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Venezuela', 'Perú'],
                            datasets: [{
                                data: [n_v, n_p],
                                backgroundColor: [colorWarning, colorAccent],
                                hoverBackgroundColor: ['#fde047', colorAccentSoft],
                                borderColor: '#020617',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            ...baseChartOptions,
                            cutout: '60%',
                            plugins: {
                                ...baseChartOptions.plugins,
                                legend: {
                                    ...baseChartOptions.plugins.legend,
                                    position: 'bottom'
                                }
                            }
                        }
                    });

                    document.getElementById("nacionalidadResumen").innerHTML =
                        `<div class="summary-main">
                            <div class="summary-title">Total Nacionalidades</div>
                            <div class="summary-number">${n_v + n_p}</div>
                            <div class="summary-detail">
                                Venezolanos: <strong>${n_v}</strong> &nbsp;·&nbsp;
                                Peruanos: <strong>${n_p}</strong>
                            </div>
                        </div>
                        <div class="summary-badge">
                            Composición de origen
                        </div>`;

                    // SITUACIÓN LEGAL
                    const situacionObj = data.situacion[0];
                    const sitKeys = Object.keys(situacionObj);
                    const sitValues = Object.values(situacionObj);

                    const situacionColors = [
                        colorAccent,
                        colorInfo,
                        colorWarning,
                        colorPurple,
                        colorDanger,
                        colorSlate
                    ];

                    const situacionCtx = document.getElementById('situacionChart');
                    new Chart(situacionCtx, {
                        type: 'bar',
                        data: {
                            labels: sitKeys,
                            datasets: [{
                                label: 'Cantidad',
                                data: sitValues,
                                backgroundColor: sitValues.map((_, i) => situacionColors[i % situacionColors.length]),
                                hoverBackgroundColor: sitValues.map((_, i) => situacionColors[i % situacionColors.length] + 'dd'),
                                borderRadius: 6,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            ...baseChartOptions,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#e5e7eb'
                                    },
                                    grid: {
                                        color: 'rgba(75, 85, 99, 0.4)'
                                    }
                                },
                                x: {
                                    ticks: { color: '#e5e7eb' },
                                    grid: { display: false }
                                }
                            },
                            plugins: {
                                ...baseChartOptions.plugins,
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });

                    document.getElementById("situacionResumen").innerHTML =
                        `<div class="summary-main">
                            <div class="summary-title">Situación Total</div>
                            <div class="summary-number">${sitValues.reduce((a, b) => a + b, 0)}</div>
                            <div class="summary-detail">
                                ${sitKeys.map((k, i) => `<span>${k}: <strong>${sitValues[i]}</strong></span>`).join(" · ")}
                            </div>
                        </div>
                        <div class="summary-badge">
                            Seguimiento procesal
                        </div>`;
                })
                .catch(err => {
                    console.warn('No se pudieron inicializar detenidos:', err);
                });
        }

        ///////////////////////////
        //      INCAUTACIONES
        ///////////////////////////
        function initIncautaciones() {
            fetchJson('./data/incautado.json')
                .then(data => {
                    const vehMenores = data.vehiculos.menores || 0;
                    const vehMayores = data.vehiculos.mayores || 0;
                    const celulares = data.celulares.total || 0;
                    const dineroTotal = data.dinero.total || 0;

                    const totalDrogas = data["DROGAS POR ENVOLTORIOS"]
                        .reduce((a, b) => a + (b.cantidad || 0), 0);

                    const totalArmas = data["ARMAS DE FUEGO"]
                        .reduce((a, b) => a + (b.cantidad || 0), 0);

                    const totalExplosivos = data["EXPLOSIVOS"]
                        .reduce((a, b) => a + (b.cantidad || 0), 0);

                    const cargadores = (data.CARGADORES?.total) || 0;
                    const municiones = (data.MUNICIONES?.total) || 0;

                    // ESPECIES (SIN DINERO)
                    const labelsEspecies = [
                        "Veh. menores (motos, trimotos)",
                        "Veh. mayores (autos, camiones)",
                        "Celulares",
                        "Drogas (envoltorios)",
                        "Armas de fuego",
                        "Cargadores",
                        "Explosivos",
                        "Municiones"
                    ];

                    const valoresEspecies = [
                        vehMenores,
                        vehMayores,
                        celulares,
                        totalDrogas,
                        totalArmas,
                        cargadores,
                        totalExplosivos,
                        municiones
                    ];

                    const incautacionColors = [
                        colorAccent, colorAccentAlt, colorInfo, colorWarning,
                        colorDanger, colorPurple, colorSlate, '#22d3ee'
                    ];

                    const especiesCtx = document.getElementById('especiesChart');
                    new Chart(especiesCtx, {
                        type: 'bar',
                        data: {
                            labels: labelsEspecies,
                            datasets: [{
                                label: 'Cantidad por tipo de especie incautada',
                                data: valoresEspecies,
                                backgroundColor: valoresEspecies.map((_, i) => incautacionColors[i % incautacionColors.length]),
                                hoverBackgroundColor: valoresEspecies.map((_, i) => incautacionColors[i % incautacionColors.length] + 'dd'),
                                borderRadius: 7,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            ...baseChartOptions,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { color: '#e5e7eb' },
                                    grid: { color: 'rgba(75, 85, 99, 0.4)' }
                                },
                                x: {
                                    ticks: {
                                        color: '#e5e7eb',
                                        maxRotation: 35,
                                        minRotation: 0,
                                        font: { size: 10 }
                                    },
                                    grid: { display: false }
                                }
                            },
                            plugins: {
                                ...baseChartOptions.plugins,
                                legend: {
                                    display: true,
                                    labels: {
                                        color: '#e5e7eb',
                                        font: { size: 10 }
                                    }
                                }
                            }
                        }
                    });

                    const totalEspecies = valoresEspecies.reduce((a, b) => a + b, 0);
                    const topIndices = [...valoresEspecies]
                        .map((v, i) => ({ v, i }))
                        .sort((a, b) => b.v - a.v)
                        .slice(0, 3);

                    const topTexto = topIndices
                        .map(t => `${labelsEspecies[t.i]}: <strong>${t.v}</strong>`)
                        .join(" · ");

                    document.getElementById("especiesResumen").innerHTML =
                        `<div class="summary-main">
                            <div class="summary-title">Total de especies incautadas (sin dinero)</div>
                            <div class="summary-number">${totalEspecies}</div>
                            <div class="summary-detail">
                                Cada barra representa la cantidad registrada por tipo de especie incautada.
                                <br><strong>Principales incautaciones:</strong> ${topTexto}
                            </div>
                        </div>
                        <div class="summary-badge">
                            Lectura operativa rápida
                        </div>`;

                    // DINERO (GRÁFICO POR SEPARADO)
                    const dineroCtx = document.getElementById('dineroChart');
                    new Chart(dineroCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Dinero incautado (S/)'],
                            datasets: [{
                                data: [dineroTotal],
                                backgroundColor: [colorWarning],
                                hoverBackgroundColor: ['#fde047'],
                                borderColor: '#020617',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            ...baseChartOptions,
                            cutout: '65%',
                            plugins: {
                                ...baseChartOptions.plugins,
                                legend: {
                                    ...baseChartOptions.plugins.legend,
                                    position: 'bottom'
                                }
                            }
                        }
                    });

                    document.getElementById("dineroResumen").innerHTML =
                        `<div class="summary-main">
                            <div class="summary-title">Monto total incautado</div>
                            <div class="summary-number">S/ ${dineroTotal.toLocaleString('es-PE')}</div>
                            <div class="summary-detail">
                                Representa el total de dinero decomisado en las intervenciones vinculadas
                                a casos de extorsión.
                            </div>
                        </div>
                        <div class="summary-badge">
                            Impacto económico
                        </div>`;
                })
                .catch(err => {
                    console.warn('No se pudieron inicializar incautaciones:', err);
                });
        }

        ///////////////////////////
        //      DENUNCIAS / DISTRITOS
        ///////////////////////////
        function initDenuncias() {
            fetchJson('./data/denuncias_completo.json')
                .then(data => {
                    const denunciasCtx = document.getElementById('denunciasChart');

                    const maxValor = Math.max(...data.ejeY);

                    const barrasColores = data.ejeY.map(v => {
                        const intensidad = v / maxValor;
                        if (intensidad > 0.75) return colorDanger;
                        if (intensidad > 0.5) return colorWarning;
                        if (intensidad > 0.25) return colorAccentAlt;
                        return colorAccent;
                    });

                    new Chart(denunciasCtx, {
                        type: 'bar',
                        data: {
                            labels: data.ejeX,
                            datasets: [{
                                label: 'Denuncias registradas',
                                data: data.ejeY,
                                backgroundColor: barrasColores,
                                hoverBackgroundColor: barrasColores.map(c => c + 'dd'),
                                borderRadius: 5,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            ...baseChartOptions,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { color: '#e5e7eb' },
                                    grid: { color: 'rgba(75, 85, 99, 0.4)' }
                                },
                                x: {
                                    ticks: { color: '#e5e7eb', maxRotation: 45, minRotation: 0 },
                                    grid: { display: false }
                                }
                            },
                            plugins: {
                                ...baseChartOptions.plugins,
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });

                    const totalDenuncias = data.ejeY.reduce((a, b) => a + b, 0);
                    document.getElementById("denunciasResumen").innerHTML =
                        `<div class="summary-main">
                            <div class="summary-title">Total Denuncias</div>
                            <div class="summary-number">${totalDenuncias}</div>
                            <div class="summary-detail">
                                ${data.ejeX.length} distritos con registro de denuncias.
                            </div>
                        </div>
                        <div class="summary-badge">
                            Foco territorial
                        </div>`;

                    const distritos = data.ejeX.map((d, i) => ({ nombre: d, valor: data.ejeY[i] }));
                    distritos.sort((a, b) => b.valor - a.valor);

                    const listContainer = document.getElementById("districtList");
                    listContainer.innerHTML = distritos.map((d, idx) =>
                        `<div class="district-item">
                            <span class="district-name">${idx + 1}. ${d.nombre}</span>
                            <span class="district-count">${d.valor}</span>
                        </div>`
                    ).join("");
                })
                .catch(err => {
                    console.warn('No se pudieron inicializar denuncias:', err);
                });
        }

        // Inicialización principal
        (function initDashboard() {
            if (isLocalFile) {
                console.warn('Ejecutando en modo file://. Los fetch a JSON serán bloqueados por el navegador.');
                showEnvWarning();
                putLocalSummaryPlaceholders();
                // No cargamos datos ni charts para evitar errores de red
            } else {
                // Modo servidor (Live Server, hosting, etc.)
                initDetenidos();
                initIncautaciones();
                initDenuncias();
            }
        })();
    </script>

</body>

</html>